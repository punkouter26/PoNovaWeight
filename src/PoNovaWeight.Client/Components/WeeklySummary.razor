@using PoNovaWeight.Shared.Contracts

<div class="bg-white dark:bg-dark-card rounded-2xl shadow-elevation-2 border border-healthy-light dark:border-dark-border p-4 mb-4">
    @if (Summary.Days.All(d => d.Proteins == 0 && d.Vegetables == 0 && d.Fruits == 0 && d.Starches == 0 && d.Fats == 0 && d.Dairy == 0))
    {
        <!-- Empty Week State -->
        <div class="text-center py-6">
            <div class="w-16 h-16 mx-auto mb-3 rounded-full bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center">
                <svg class="w-8 h-8 text-indigo-500" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 class="text-sm font-semibold text-healthy-text dark:text-dark-text mb-1">No Meals Logged This Week</h3>
            <p class="text-xs text-healthy-muted dark:text-dark-muted mb-3">
                Start logging your meals to see your weekly progress
            </p>
            <a href="/day/@DateOnly.FromDateTime(DateTime.Today).ToString("yyyy-MM-dd")" 
               class="inline-flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white text-sm font-medium rounded-lg hover:bg-indigo-700 transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" />
                </svg>
                Log Today's Meals
            </a>
        </div>
    }
    else
    {
        <!-- Header -->
        <div class="flex items-center justify-between mb-4">
        <h2 class="text-sm font-semibold text-healthy-text dark:text-dark-text flex items-center gap-2">
            <div class="w-8 h-8 rounded-lg bg-indigo-100 dark:bg-indigo-900/30 flex items-center justify-center">
                <svg class="w-5 h-5 text-indigo-600 dark:text-indigo-400" fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 13.125C3 12.504 3.504 12 4.125 12h2.25c.621 0 1.125.504 1.125 1.125v6.75C7.5 20.496 6.996 21 6.375 21h-2.25A1.125 1.125 0 013 19.875v-6.75zM9.75 8.625c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125v11.25c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V8.625zM16.5 4.125c0-.621.504-1.125 1.125-1.125h2.25C20.496 3 21 3.504 21 4.125v15.75c0 .621-.504 1.125-1.125 1.125h-2.25a1.125 1.125 0 01-1.125-1.125V4.125z"/></svg>
            </div>
            Week Summary
        </h2>
        <span class="text-xs text-healthy-muted dark:text-dark-muted bg-healthy-light dark:bg-dark-border px-3 py-1 rounded-full font-medium">
            @Summary.WeekStart.ToString("MMM d") - @Summary.WeekEnd.ToString("MMM d")
        </span>
    </div>

    <!-- Category grid -->
    <div class="grid grid-cols-3 gap-3 text-center">
        @foreach (var (label, current, target, icon, bgClass, iconClass, isMax) in GetCategoryData())
        {
            var percent = target > 0 ? Math.Min(100, (int)((double)current / target * 100)) : 0;
            var isMet = isMax ? current <= target : current >= target;
            
            <div class="bg-gray-50 dark:bg-dark-border rounded-xl p-3">
                <div class="flex items-center justify-center gap-2 mb-2">
                    <div class="w-7 h-7 rounded-lg @bgClass flex items-center justify-center">
                        @((MarkupString)icon)
                    </div>
                    <span class="text-lg font-bold @(isMax && current > target ? "text-healthy-danger" : "text-healthy-text dark:text-dark-text")">@current</span>
                </div>
                <div class="h-2 bg-gray-200 dark:bg-dark-bg rounded-full overflow-hidden mb-2">
                    <div class="h-full rounded-full transition-all @(isMet ? "bg-healthy-primary" : isMax && current > target ? "bg-healthy-danger" : "bg-healthy-warning")"
                         style="width: @percent%"></div>
                </div>
                <div class="text-xs text-healthy-muted dark:text-dark-muted">
                    @label <span class="@(isMet ? "text-healthy-primary font-medium" : "")">/@target@(isMax ? " max" : "")</span>
                </div>
            </div>
        }
    </div>
    }
</div>

@code {
    [Parameter, EditorRequired]
    public WeeklySummaryDto Summary { get; set; } = null!;

    private IEnumerable<(string label, int current, int target, string icon, string bgClass, string iconClass, bool isMax)> GetCategoryData()
    {
        yield return ("Protein", Summary.TotalProteins, Summary.WeeklyProteinTarget, 
            "<svg class=\"w-4 h-4 text-amber-600\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M15.362 5.214A8.252 8.252 0 0112 21 8.25 8.25 0 016.038 7.048 8.287 8.287 0 009 9.6a8.983 8.983 0 013.361-6.867 8.21 8.21 0 003 2.48z\"/></svg>",
            "bg-amber-100 dark:bg-amber-900/30", "text-amber-600", false);
        yield return ("Veggies", Summary.TotalVegetables, Summary.WeeklyVegetableTarget, 
            "<svg class=\"w-4 h-4 text-emerald-600\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"1.5\" viewBox=\"0 0 24 24\"><path stroke-linecap=\"round\" stroke-linejoin=\"round\" d=\"M12 18v-5.25m0 0a6.01 6.01 0 001.5-.189m-1.5.189a6.01 6.01 0 01-1.5-.189m3.75 7.478a12.06 12.06 0 01-4.5 0m3.75 2.383a14.406 14.406 0 01-3 0M14.25 18v-.192c0-.983.658-1.823 1.508-2.316a7.5 7.5 0 10-7.517 0c.85.493 1.509 1.333 1.509 2.316V18\"/></svg>",
            "bg-emerald-100 dark:bg-emerald-900/30", "text-emerald-600", false);
        yield return ("Fruit", Summary.TotalFruits, Summary.WeeklyFruitTarget, 
            "<svg class=\"w-4 h-4 text-rose-500\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z\"/></svg>",
            "bg-rose-100 dark:bg-rose-900/30", "text-rose-500", false);
        yield return ("Starch", Summary.TotalStarches, Summary.WeeklyStarchTarget, 
            "<svg class=\"w-4 h-4 text-orange-500\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12.378 1.602a.75.75 0 00-.756 0L3 6.632l9 5.25 9-5.25-8.622-5.03zM21.75 7.93l-9 5.25v9l8.628-5.032a.75.75 0 00.372-.648V7.93zM11.25 22.18v-9l-9-5.25v8.57a.75.75 0 00.372.648l8.628 5.033z\"/></svg>",
            "bg-orange-100 dark:bg-orange-900/30", "text-orange-500", false);
        yield return ("Fats", Summary.TotalFats, Summary.WeeklyFatTarget, 
            "<svg class=\"w-4 h-4 text-yellow-600\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path d=\"M12 2c-5.33 4.55-8 8.48-8 11.8 0 4.98 3.8 8.2 8 8.2s8-3.22 8-8.2c0-3.32-2.67-7.25-8-11.8z\"/></svg>",
            "bg-yellow-100 dark:bg-yellow-900/30", "text-yellow-600", false);
        yield return ("Dairy", Summary.TotalDairy, Summary.WeeklyDairyMax, 
            "<svg class=\"w-4 h-4 text-sky-500\" fill=\"currentColor\" viewBox=\"0 0 24 24\"><path fill-rule=\"evenodd\" d=\"M12.963 2.286a.75.75 0 00-1.071-.136 9.742 9.742 0 00-3.539 6.176 7.547 7.547 0 01-1.705-1.715.75.75 0 00-1.152-.082A9 9 0 1021 11.25c0-.387-.025-.77-.071-1.147a.75.75 0 00-1.296-.349 7.549 7.549 0 01-1.796 1.398 9.75 9.75 0 00-4.874-8.866z\" clip-rule=\"evenodd\"/></svg>",
            "bg-sky-100 dark:bg-sky-900/30", "text-sky-500", true);
    }
}
